- hosts: web
  become: yes

  tasks:
    - name: Ensure Docker is installed
      apt:
        name: docker.io
        state: present
        update_cache: yes

    - name: Copy Docker image to EC2
      copy:
        src: static-web.tar
        dest: /home/ubuntu/static-web.tar
        mode: '0644'

    - name: Stop old container if running
      shell: docker stop aj-static-site || true

    - name: Remove old container
      shell: docker rm aj-static-site || true

    - name: Load new Docker image
      shell: docker load -i /home/ubuntu/static-web.tar

    - name: Run new container
      shell: docker run -d -p 80:80 --restart always --name aj-static-site aj-static-site:latest

    - name: Clean up unused Docker resources
      shell: docker system prune -f
